# Python で「テスト全く書けない」から「テストの書き方少し分かってきた」になるまでにやったこと

## 中級者になりたい！！

<!-- ちょうど PyCon の投稿期限前後で
プログラミングを勉強して 2 年

自分がずっと思っていたのは，
「中級者になりたい！！！」
という思い．

自分の中の中級者のイメージをツイートの画像で見せる

・テストを書ける（レベル感は分からないが）
・アプリケーションのログを設計し，エラーが起きたときに対処することを念頭において開発できる
・多少なりとも OSS にコントリビュートしてる

...etc

-->

## 自分の中のテストのイメージ

テストのイメージ

- 難しそう
- ソフトウェアエンジニアとして働きたいならテスト書けなければ仕事にならない
- 必須事項
- いつか勉強しないといけない...

## テストの勉強を始める前に自分が分かっていたことと分かっていなかったこと

- 分かっていたこと
  - テストは「自分が書いたソフトウェアが期待通りの動作をすることを保証するもの」
  - テストケースを突くゲームみたいなもので，テストケースを自分で把握できていないと良いテスト（AtCoder でさんざん落とされた）
  - 単体テストと結合テストってやつがある（意味は理解していなかった，後述）

<!-- 逆に分からなかったこと，テストについて不安を感じていたことはたくさんあります．挙げるとキリはありませんが，主にこのスライドような感じです．

恐らく的外れな不安もあるかと思いますが，大方
 -->

- 分かっていなかったこと（テストについて不安を感じていたこと）
  - 自分が書いたコードの何をテストすれば良いか分からない（）
  - 自分が書いたテストがテストたりうるのかが判断できない（テストにならないテストを書いてしまうのではないかという不安）
  - コーナーケースを上手く突くことができるの？
  - ...etc

要するに「**何をテストすれば良いのか分からない**」という状態．

## どう勉強して行ったか

<!-- じゃあ具体的にどうやって勉強して行ったか．
ありきたりな流れかもしれませんが，こんな感じになります． -->

1. （基本）ものは試しで Python のテストフレームワーク unittest のドキュメントを全部読んでサンプルを動かしてみた
2. （インプット）何をテストすれば良いかを学ぶ．OSS のテストコードを読んで何をテストすれば良いのかを掴む．
3. （実践）自分が開発しているツールに対してテストを書いてみる．

## 1. （基本）ものは試しで Python のテストフレームワーク unittest のドキュメントを全部読んでサンプルを動かしてみた

### 何はともあれ unittest のドキュメントを読む

- ドキュメントを拝借．
- （ブログにまとめてます）

### ドキュメントを読んでわかったこと

- 色んなテストケースを自分で作ることができる

  - `assertEqual(first, second)`：first と second が等しいかをテスト．基本中の基本．
  - `assertRegex(text, regex)`：文字列が正規表現にマッチするか
  - `assertAlmostEqual(first, second, places, delta)`：first と second が指定した少数位で丸めた差分が delta 以内に収まるか
  - `assertRaises(exception, callable)`：callable を呼んだ時に想定通りの例外が発生するか

<!--
これ以外にもたくさんのテストケースを実装できる `assert*()` メソッドが存在し，
色んな場面，動作のテストを行うことができる．
-->

- テストに関する用語
  - テストケース
  - テストランナー
  - テストディスカバリ
  - （大事）テストフィクスチャ

## 2. （インプット）何をテストすれば良いかを学ぶ．OSS のテストコードを読んで何をテストすれば良いのかを掴む．

## 3. （アウトプット）自分が開発しているツールに対してテストを書いてみる．

## 先輩方のテストに対するお言葉

<!-- 各種テストに関するツイートを拝借 -->

- [@songmu](https://twitter.com/songmu/status/1258764656555917314)
  - 実際テスト書かないまま積み上がったコードにテスト書くの難易度高いので、最初からちゃんとやるのが良いと僕の中では結論付けられているし「レガシーコードからの脱却」にもそれに近いことが書かれている
- [@songmu](https://twitter.com/songmu/status/1258763581060812800)

  - 密結合にした結果、テストは書きづらくなるけど、一時的な生産性が上がる、みたいな話があるよね。何かそれは一般的な事象として名前ついていたりするのかな…？

- [@mpyw](https://twitter.com/mpyw/status/1258276638002798592)

  - ユニットテストでモックを使いつつ最後に一発通しでおおまかに実行する機能テストが 1 個あればいいと思ってる派なんだけどどう？
  - モックも粒度によるよな．そのパッケージ内の責務委譲先クラスが副作用を起こさない場合はモックいらない（起こす場合はいる）．外部パッケージの場合は基本的にいる．
  - モック作らないといけないところは薄くして，機能テストとかのテストが書きやすいところをちゃんと書く感じにしますねー

- [t-wada のブログ - プライベートメソッドのテストは書かないもの？](https://t-wada.hatenablog.jp/entry/should-we-test-private-methods)

- [@little_hand_s](https://twitter.com/little_hand_s/status/1253945737760530434)

  - 「スピード重視だから」とテストを書かずに開発することは，「スピード重視だから」とマラソンの最初の数キロを全力疾走することに似ている．テストを書くことと、長期な視点でのペース配分は似ている．それは技術であり，戦略なのだ．

- [@t_wada](https://twitter.com/t_wada/status/1252058144672342018)

  - テストのマニフェスト。
  - 最後にテストするよりずっとテストし続ける。
  - バグの発見よりバグの防止。
  - 機能性をチェックするよりチームが理解している価値をテストする。
  - システムを破壊するより最高のシステムを構築する。
  - [ブロッコリーのブログ - テストに対する考え方「Testing Manifesto」を翻訳したので紹介します](https://nihonbuson.hatenadiary.jp/entry/TestingManifesto)

- [@little_hand_s](https://twitter.com/little_hand_s/status/1250209347990253569)

  - 結局、テストを書きやすい実装にしていくと設計がきれいになっていくということなのだ。なので小さくテストを書いて実装していく事は超重要。
  - 個人的にはアーキテクチャのデザインがよくないといくらテストを増やしてもアプリのクオリティは上がらないと思う

- [@t_wada](https://twitter.com/t_wada/status/1182819951859494914)

  - 私は無駄なテストコードはメンテナンスコスト増大を生むので消すことと、実際のやり方のデモを講演に組み込んでいます（例えば de:code の動画で観れます）。では「想像上の t_wada」は誰なんだという….…
  - [テストを書きたくない話](https://speakerdeck.com/kishida/i-dont-want-to-write-tests)

- [@t_wada](https://twitter.com/t_wada/status/1258673492175712256)
  - ほとんどの場合であってると思います
    - RT with comment: 単体テストが書きにくい=もとがクソコード理論．ほとんどの場合であってる．
- [@gureru_dev](https://twitter.com/guregu_dev/status/1257998106139885577)

  - mock 関連ライブラリまで書いた身ですが色々経験してやっぱり極力 mock を避けた方がいいと思う．
  - mock 使いまくりの単体テストは mock ライブラリのテストに過ぎない．

- [@Shinoda_IT](https://twitter.com/Shinoda_IT/status/1258270483125919744)
  - モックの誤用が広がる原因は，「単体テストのため」という間違った用途の紹介がさも正解のように広まっていることでしょう
  - 本当は，スローテストの防止，API 呼び出しの規約，完成前のモジュールの置き換えなどの理由が正しい用途なのに
